<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Shift Assignment -Aplicación para la Asignación de Personal a Turnos en una Clínica u Hospital">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0a23">
    <title>Shift Assignment - Asignación de Personal a Turnos</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="./css/styles.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="./img/icons/icon-72x72.png">
</head>

<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html"><img src="./img/logo-shiftassignment.svg" height="60" width="60">
                Shift Assignment </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav" id="mainNavLinks">
                    <!-- Links will be dynamically added here based on auth state -->
                </ul>
                <div class="d-flex align-items-center">
                    <div class="theme-switch-wrapper">
                        <svg class="theme-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path id="sun-icon"
                                d="M12 17.5C14.7614 17.5 17 15.2614 17 12.5C17 9.73858 14.7614 7.5 12 7.5C9.23858 7.5 7 9.73858 7 12.5C7 15.2614 9.23858 17.5 12 17.5Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path id="sun-rays"
                                d="M12 1V3M12 22V24M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M22 12H24M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path id="moon-icon" style="display:none;"
                                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z" fill="currentColor" />
                        </svg>
                        <label class="theme-switch ms-2">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="slider round"></span>
                        </label>
                        <svg class="theme-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path id="moon-icon-right" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"
                                fill="currentColor" />
                            <path id="sun-icon-right" style="display:none;"
                                d="M12 17.5C14.7614 17.5 17 15.2614 17 12.5C17 9.73858 14.7614 7.5 12 7.5C9.23858 7.5 7 9.73858 7 12.5C7 15.2614 9.23858 17.5 12 17.5Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path id="sun-rays-right" style="display:none;"
                                d="M12 1V3M12 22V24M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M22 12H24M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Authentication Section -->
    <section id="auth-section" class="content-section active">
        <div class="card">
            <div class="card-header">
                <h3>Bienvenido a Shift Assignment</h3>
            </div>
            <div class="card-body">
                <!-- Login Form -->
                <form id="loginForm" class="mb-4">
                    <h5 class="text-center mb-3">Iniciar Sesión</h5>
                    <div class="mb-3">
                        <label for="loginUsername" class="form-label">Usuario</label>
                        <input type="text" class="form-control" id="loginUsername" required>
                    </div>
                    <div class="mb-3">
                        <label for="loginPassword" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-2">Iniciar Sesión</button>
                    <p class="text-center">¿No tienes cuenta? <a href="#" id="showRegisterForm">Regístrate aquí</a></p>
                </form>

                <!-- Registration Form -->
                <form id="registerForm" style="display:none;">
                    <h5 class="text-center mb-3">Registrarse</h5>
                    <div class="mb-3">
                        <label for="registerUsername" class="form-label">Usuario</label>
                        <input type="text" class="form-control" id="registerUsername" required>
                    </div>
                    <div class="mb-3">
                        <label for="registerPassword" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="registerPassword" required>
                    </div>
                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Confirmar Contraseña</label>
                        <input type="password" class="form-control" id="confirmPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-2">Registrarme</button>
                    <p class="text-center">¿Ya tienes cuenta? <a href="#" id="showLoginForm">Inicia Sesión aquí</a></p>
                </form>
            </div>
        </div>
    </section>

    <!-- Main Application Content -->
    <div class="container" id="app-content" style="display:none;">
        <section id="staff-section" class="mb-5 content-section active">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    Personal Disponible
                    <div>
                        <button type="button" class="btn btn-light btn-sm me-2" onclick="exportStaffToCSV()">
                            Exportar a Excel
                        </button>
                        <button type="button" class="btn btn-light btn-sm" data-bs-toggle="modal"
                            data-bs-target="#addStaffModal" onclick="prepareAddStaffModal()">
                            + Añadir Personal
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Identificación</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Departamento</th>
                                    <th scope="col">Cargo</th>
                                    <th scope="col">Teléfono</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Fecha Contratación</th>
                                    <th scope="col">Tipo Contrato</th>
                                    <th scope="col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="staffList">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="shifts-section" class="mb-5 content-section">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    Turnos Definidos
                    <div>
                        <button type="button" class="btn btn-light btn-sm me-2" onclick="exportShiftsToCSV()">
                            Exportar a Excel
                        </button>
                        <button type="button" class="btn btn-light btn-sm" data-bs-toggle="modal"
                            data-bs-target="#addShiftModal" onclick="prepareAddShiftModal()">
                            + Añadir Turno
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Tipo</th>
                                    <th scope="col">Fecha</th>
                                    <th scope="col">Hora Inicio</th>
                                    <th scope="col">Hora Finalización</th>
                                    <th scope="col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="shiftList">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="assignment-section" class="mb-5 content-section">
            <div class="card">
                <div class="card-header" id="assignmentFormHeader">
                    Asignar Personal a Turno
                </div>
                <div class="card-body">
                    <form id="assignmentForm">
                        <input type="hidden" id="assignmentIdToEdit">
                        <div class="mb-3">
                            <label for="assignStaff" class="form-label">Personal</label>
                            <select class="form-select" id="assignStaff" required>
                                <option value="">Seleccione Personal</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="assignShift" class="form-label">Turno</label>
                            <select class="form-select" id="assignShift" required>
                                <option value="">Seleccione Turno</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="assignDate" class="form-label">Fecha</label>
                            <input type="date" class="form-control" id="assignDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary" id="saveAssignmentBtn">Asignar Turno</button>
                    </form>
                </div>
            </div>
        </section>

        <section id="schedule-section" class="mb-5 content-section">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    Horario de Turnos
                    <button type="button" class="btn btn-light btn-sm" onclick="exportAssignmentsToCSV()">
                        Exportar a Excel
                    </button>
                </div>
                <div class="card-body">
                    <div id="scheduleDisplay" class="schedule-grid">
                        <p class="no-assignments" id="noAssignmentsMessage">No hay asignaciones de turnos para mostrar.
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modales -->

    <!-- Modal Añadir/Editar Personal (reutilizado) -->
    <div class="modal fade" id="addStaffModal" tabindex="-1" aria-labelledby="addStaffModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addStaffModalLabel">Añadir Nuevo Personal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addStaffForm">
                    <input type="hidden" id="staffIdToEdit">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="staffIdNumber" class="form-label">Identificación del Empleado</label>
                            <input type="text" class="form-control" id="staffIdNumber" required>
                        </div>
                        <div class="mb-3">
                            <label for="staffName" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="staffName" required>
                        </div>
                        <div class="mb-3">
                            <label for="staffDepartment" class="form-label">Departamento/Área</label>
                            <select class="form-select" id="staffDepartment" required>
                                <option value="">Seleccione Departamento</option>
                                <option value="Enfermería">Enfermería</option>
                                <option value="Médicos">Médicos</option>
                                <option value="Administración">Administración</option>
                                <option value="Limpieza">Limpieza</option>
                                <option value="Otros">Otros</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="staffPosition" class="form-label">Rol/Cargo</label>
                            <select class="form-select" id="staffPosition" required>
                                <option value="">Seleccione Rol/Cargo</option>
                                <option value="Enfermero/a">Enfermero/a</option>
                                <option value="Médico General">Médico General</option>
                                <option value="Especialista">Especialista</option>
                                <option value="Auxiliar">Auxiliar</option>
                                <option value="Administrativo">Administrativo</option>
                                <option value="Personal de Limpieza">Personal de Limpieza</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="staffPhone" class="form-label">Número de Teléfono</label>
                            <input type="tel" class="form-control" id="staffPhone" required>
                        </div>
                        <div class="mb-3">
                            <label for="staffEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="staffEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="staffHireDate" class="form-label">Fecha de Contratación</label>
                            <input type="date" class="form-control" id="staffHireDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="staffContractType" class="form-label">Tipo de Contrato</label>
                            <input type="text" class="form-control" id="staffContractType" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary"
                            data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="saveStaffBtn">Guardar Personal</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Añadir/Editar Turno (reutilizado) -->
    <div class="modal fade" id="addShiftModal" tabindex="-1" aria-labelledby="addShiftModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addShiftModalLabel">Añadir Nuevo Turno</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addShiftForm">
                    <input type="hidden" id="shiftIdToEdit">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="shiftType" class="form-label">Tipo de Turno</label>
                            <select class="form-select" id="shiftType" required>
                                <option value="">Seleccione Tipo</option>
                                <option value="Mañana">Mañana</option>
                                <option value="Tarde">Tarde</option>
                                <option value="Noche">Noche</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="shiftDate" class="form-label">Fecha del Turno</label>
                            <input type="date" class="form-control" id="shiftDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="shiftStartTime" class="form-label">Hora Inicio</label>
                            <input type="time" class="form-control" id="shiftStartTime" required>
                        </div>
                        <div class="mb-3">
                            <label for="shiftEndTime" class="form-label">Hora Finalización</label>
                            <input type="time" class="form-control" id="shiftEndTime" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary"
                            data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="saveShiftBtn">Guardar Turno</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Alerta Personalizada -->
    <div class="modal fade" id="customAlertModal" tabindex="-1" aria-labelledby="customAlertModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="customAlertModalLabel">Error de Validación</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body" id="customAlertMessage">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/algoritmo-shiftassignment.js"></script>
    <script src="./service-worker.js"></script>
    <script>
        // Registra el Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado con éxito:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Fallo el registro del Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>